<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Users & Map Points — v3 (Modules + Commands + Docked Menus)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsoneditor@9.10.4/dist/jsoneditor.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/jsoneditor@9.10.4/dist/jsoneditor.min.js"></script>
    <link href="https://unpkg.com/tabulator-tables@6.2.1/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@6.2.1/dist/js/tabulator.min.js"></script>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body data-theme="light" data-font="medium">
    <!-- 0.0) STATUS BAR (no longer docked) -->
    <div id="statusBar" class="status-bar">
      <div id="statusBar-title" class="status-bar-title">Dani-Geo-Coins</div>
      <div id="statusBar-user" class="status-bar-user">Not logged in</div>
      <button id="statusBar-errors" class="error-indicator-btn" style="display: none;"></button>
    </div>

    <!-- 0.1) MENU TOP (no longer docked) -->
    <div id="menuTop" class="section">
      <div id="menuTop-header" class="section-header">
        <div class="title-left">
          <span class="chev" id="chev-menuTop">▼</span>
          <span class="title-text">Menu (Top)</span>
        </div>
        <div id="menuTop-title-commands" class="cmd-bar title-cmds"></div>
      </div>
      <div class="section-content">
        <div id="menuTop-top-commands" class="cmd-bar"></div>
        <div id="menuTop-bottom-commands" class="cmd-bar"></div>
      </div>
    </div>

    <!-- 1.1) LOGIN -->
    <div id="login" class="section">
      <div id="login-header" class="section-header">
        <div class="title-left">
          <span class="chev" id="chev-login">▼</span>
          <span class="title-text">Login</span>
        </div>
      </div>
      <div class="section-content">
        <form id="login-form" onsubmit="return false;">
          <label>Username <input id="login-username" autocomplete="username" /></label>
          <label>Password <input id="login-password" type="password" autocomplete="current-password" /></label>
        </form>
      </div>
    </div>

    <!-- 1.2) USERS LIST -->
    <div id="usersList" class="section">
      <div id="usersList-header" class="section-header">
        <div class="title-left">
          <span class="chev" id="chev-usersList">▼</span>
          <span class="title-text">Users</span>
        </div>
      </div>
      <div class="section-content">
        <div id="users-empty" style="display: none">No registered users.</div>
        <div id="users-table"></div>
      </div>
    </div>

    <!-- 1.3) USER DETAILS -->
    <div id="userDetails" class="section">
      <div id="userDetails-header" class="section-header">
        <div class="title-left">
          <span class="chev" id="chev-userDetails">▼</span>
          <span class="title-text">User Details <span id="ud-mode-indicator"></span></span>
        </div>
      </div>
      <div class="section-content">
        <form id="userDetails-form" onsubmit="return false;">
          <input type="hidden" id="ud-username-old" />
          <label>Username <input id="ud-username" autocomplete="username" /></label>
          <label>Name <input id="ud-name" autocomplete="name" /></label>
          <!-- <label>Surname <input id="ud-surname" /></label> -->
          <label>Password <input id="ud-password" type="password" autocomplete="new-password" /></label>
          <!-- §kamen_20251010_175213-->

          <!-- §kamen_20251010_180320  -->
          <fieldset>
            <legend>Roles</legend>
            <label><input type="checkbox" id="ud-role-admin" value="admin" />Admin</label>
            <label><input type="checkbox" id="ud-role-seeker" value="seeker" />Seeker</label>
            <label><input type="checkbox" id="ud-role-hider" value="hider" />Hider</label>
            <label><input type="checkbox" id="ud-role-tester" value="tester" />Tester</label>
            <label><input type="checkbox" id="ud-role-developer" value="developer" />Developer</label>
          </fieldset>
        </form>
      </div>
    </div>

    <!-- 1.4) MESSAGE -->
    <div id="message" class="section">
      <div id="message-header" class="section-header">
        <div class="title-left">
          <span class="chev" id="chev-message">▼</span>
          <span class="title-text">Message</span>
        </div>
      </div>
      <div class="section-content">
        <div id="message-text"></div>
      </div>
    </div>

    <!-- 1.5) MAP POINTS -->
    <div id="mapPoints" class="section">
      <div id="mapPoints-header" class="section-header">
        <div class="title-left">
          <span class="chev" id="chev-mapPoints">▼</span>
          <span class="title-text">Map Points</span>
        </div>
        <div id="mapPoints-title-commands" class="cmd-bar title-cmds"></div>
      </div>
      <div class="section-content">
        <div id="mapPoints-container" class="mappoints-container">
          <!-- Left/Top: Map Points List -->
          <div id="mapPointsList" class="mappoints-list">
            <div id="mapPointsForm" class="mappoints-form">
              <input type="hidden" id="mp-id" />
              <label>Owner Username <input id="mp-username" /></label>
              <label>Title <input id="mp-title" /></label>
              <label>Latitude <input id="mp-lat" /></label>
              <label>Longitude <input id="mp-lng" /></label>
              <label>Description <textarea id="mp-desc"></textarea></label>
            </div>

            <div id="mps-empty" style="display: none">No map points.</div>
            <div id="mps-table"></div>
          </div>
          
          <!-- Resizable Divider -->
          <div id="mapPointsDivider" class="mappoints-divider"></div>
          
          <!-- Right/Bottom: Map View -->
          <div id="mapPointsGeoView" class="mappoints-geoview">
            <div id="mapPointsMap" class="mappoints-map"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- 1.6) MAP POINT DETAILS -->
    <div id="mapPointDetails" class="section">
      <div id="mapPointDetails-header" class="section-header">
        <div class="title-left">
          <span class="chev" id="chev-mapPointDetails">▼</span>
          <span class="title-text">Map Point Details <span id="mpd-mode-indicator"></span></span>
        </div>
      </div>
      <div class="section-content">
        <input type="hidden" id="mpd-id" />
        <input type="hidden" id="mpd-username" />
        <label>Title <input id="mpd-title" /></label>
        <label>Lat <input id="mpd-lat" /></label>
        <label>Lng <input id="mpd-lng" /></label>
        <label>Description <textarea id="mpd-desc"></textarea></label>
        <label>Status
          <select id="mpd-status">
            <option value="pending">Pending</option>
            <option value="found">Found</option>
            <option value="hidden">Hidden</option>
          </select>
        </label>
        <label id="mpd-code-label">Code <input id="mpd-code" /></label>
      </div>
    </div>

    <!-- 1.7) SETTINGS -->
    <div id="settings" class="section">
      <div id="settings-header" class="section-header">
        <div class="title-left">
          <span class="chev" id="chev-settings">▼</span>
          <span class="title-text">Settings</span>
        </div>
      </div>
      <div class="section-content">
        <label
          >Theme
          <select id="set-theme">
            <option value="light">light</option>
            <option value="dark">dark</option>
          </select>
        </label>
        <label
          >Font Size
          <select id="set-font">
            <option value="small">small</option>
            <option value="medium" selected>medium</option>
            <option value="large">large</option>
          </select>
        </label>
        <label style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" id="set-autoHideTopMenu" style="width: auto; margin: 0;" />
          Auto-hide top menu when viewing content
        </label>
        <label style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" id="set-errorHandler" style="width: auto; margin: 0;" />
          Enable Global Error Handler (Admin Only)
        </label>
      </div>
    </div>

    <!-- 1.8) ABOUT -->
    <div id="about" class="section">
      <div id="about-header" class="section-header">
        <div class="title-left">
          <span class="chev" id="chev-about">▼</span>
          <span class="title-text">About</span>
        </div>
      </div>
      <div class="section-content">
        <p><strong>Dani-Geo-Coins</strong> is an interactive map-based treasure hunting application where users can hide and find virtual coins on a geographic map.</p>
        <p>The app supports multiple user roles (Admin, Seeker, Hider, Tester, Developer) with role-based permissions, real-time map interactions, and comprehensive user management.</p>
        <p style="margin-top: 20px;"><strong>Developed by:</strong> Kamen Zehchev (<a href="mailto:kamenj@hotmail.com">kamenj@hotmail.com</a>)</p>
      </div>
    </div>

    <!-- 1.9) DEVELOPER TOOLS -->
    <div id="developerTools" class="section">
      <div id="developerTools-header" class="section-header">
        <div class="title-left">
          <span class="chev" id="chev-developerTools">▼</span>
          <span class="title-text">Developer Tools</span>
        </div>
      </div>
      <div class="section-content">
        <div id="jsoneditor" style="width: 100%; height: 400px; max-height: 60vh;"></div>
      </div>
    </div>

    <!-- 1.10) ERRORS -->
    <div id="errors" class="section">
      <div id="errors-header" class="section-header">
        <div class="title-left">
          <span class="chev" id="chev-errors">▼</span>
          <span class="title-text">Application Errors</span>
        </div>
      </div>
      <div class="section-content">
        <div id="errors-json-editor" style="width: 100%; height: 500px; max-height: 60vh; border: 1px solid #ccc;"></div>
      </div>
    </div>

    <!-- 0.2) MENU BOTTOM (no longer docked) -->
    <div id="menuBottom" class="section">
      <div id="menuBottom-header" class="section-header">
        <div class="title-left">
          <span class="chev" id="chev-menuBottom">▼</span>
          <span class="title-text">Menu (Bottom)</span>
        </div>
        <div id="menuBottom-title-commands" class="cmd-bar title-cmds"></div>
      </div>
      <div class="section-content">
        <div id="menuBottom-top-commands" class="cmd-bar"></div>
        <div id="menuBottom-bottom-commands" class="cmd-bar"></div>
      </div>
    </div>

    <!-- 1.10) HELP -->
    <div id="help" class="section" style="display: block;">
      <div id="help-header" class="section-header">
        <div class="title-left">
          <span class="chev" id="chev-help">▼</span>
          <span class="title-text">Help</span>
        </div>
      </div>
      <div class="section-content">
        <iframe id="help-iframe" src="help.html" style="width: 100%; height: 600px; border: none; background: white;"></iframe>
      </div>
    </div>

    <!-- Custom Prompt Modal -->
    <div id="customPromptModal" class="modal-overlay hidden">
      <div class="modal-dialog">
        <div class="modal-header">
          <h3 id="customPromptTitle">Enter Code</h3>
        </div>
        <div class="modal-body">
          <label id="customPromptLabel">Enter the code for this point:</label>
          <input type="text" id="customPromptInput" class="modal-input" autocomplete="off" />
        </div>
        <div class="modal-footer">
          <button id="customPromptCancel" class="modal-btn">Cancel</button>
          <button id="customPromptOk" class="modal-btn primary">OK</button>
        </div>
      </div>
    </div>

    <!-- Custom Alert Modal -->
    <div id="customAlertModal" class="modal-overlay hidden">
      <div class="modal-dialog">
        <div class="modal-header">
          <h3 id="customAlertTitle">Message</h3>
        </div>
        <div class="modal-body">
          <p id="customAlertMessage">Alert message here</p>
        </div>
        <div class="modal-footer">
          <button id="customAlertOk" class="modal-btn primary">OK</button>
        </div>
      </div>
    </div>

    <script type="module" src="app.js"></script>
  </body>
</html>
