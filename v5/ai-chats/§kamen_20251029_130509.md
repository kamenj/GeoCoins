§kamen_20251029_130509

# Chat: Wildcard and Boolean Filtering for Tables

## Summary
Implemented advanced wildcard filtering with OR/AND operators for both Users and Map Points tables, similar to SQL LIKE operator with boolean logic support.

---

## User Request 1
> can i write expressions in the filter textboxes for the table

**Response:**
No, the current implementation uses simple substring matching for filtering, not expression evaluation. The filter boxes use Tabulator's default "input" filter for substring matching, with some custom functions for multi-field searches.

Explained what doesn't work (comparison operators, equality checks, logical operators, regex) and provided an example of how to add expression support for numeric columns.

---

## User Request 2
> add support for complex filtering, where the text values : title, user, status found by can be filtered in the same way the Like SQL operator would act.
> for example for the Status column : P* or h*

**Implementation:**
1. Created `matchWildcard()` helper function that converts wildcard patterns to regex
2. Added wildcard filtering support for all text columns in both tables:
   - Users table (details view): Username, Name, Role
   - Users table (compact view): User field (searches across username, name, roles)
   - Map Points table (details view): Title, User, Status, Found By
   - Map Points table (compact view): Point field (searches across all fields)

**Features:**
- `*` wildcard matches any characters
- Case-insensitive matching
- Falls back to substring matching when no wildcards used
- Patterns: `P*` (starts with P), `*den` (ends with den), `*und*` (contains und)

Created documentation file: `WILDCARD_FILTERING.md`

---

## User Request 3
> a* works as a filter for the users, but a* or b* didn't

**Issue:** OR operator wasn't supported within a single filter box.

**Implementation:**
Updated `matchWildcard()` function to support OR logic:
- Split patterns by `|` or ` or ` (case-insensitive)
- Test each pattern independently
- Return true if ANY pattern matches

**Examples:**
- `a*|b*` or `a* or b*` - matches items starting with "a" OR "b"
- `pending|hidden` - matches "pending" OR "hidden"
- `*park*|*beach*` - contains "park" OR "beach"

Updated documentation to reflect OR operator support.

---

## User Request 4
> do the same for the users table

**Response:**
Confirmed that OR operator support was already implemented for the Users table since all filters use the same `matchWildcard()` function.

---

## User Request 5
> A* and S* didn't show any result for the Role filter

**Issue:** 
1. Role filter was checking against display format ("A, S, H") instead of actual role names
2. AND operator wasn't supported

**Implementation:**
1. Completely refactored `matchWildcard()` to support both AND and OR logic:
   - Detects `and` keyword for AND operations
   - Split into helper functions: `matchSinglePattern()` and `testPattern()`
   - Added support for array values (for roles)
   
2. Updated Role column filters to pass roles array directly:
   - AND logic: All patterns must match at least one role in the array
   - OR logic: Any pattern matches any role in the array

**New Filtering Capabilities:**

**OR Logic (ANY match):**
- `A*|S*` or `A* or S*` - users with Admin OR Seeker
- `admin|seeker` - same
- `a*|s*|h*` - users with any of the three roles

**AND Logic (ALL match):**
- `A* and S*` - users with BOTH Admin AND Seeker
- `admin and seeker` - same
- `a* and s* and h*` - users with all three roles

---

## Files Modified
1. `v5/app.js`:
   - Added `matchWildcard()`, `matchSinglePattern()`, `testPattern()` helper functions
   - Updated all `headerFilterFunc` in `getTableColumns()` (Users table)
   - Updated all `headerFilterFunc` in `getPointsTableColumns()` (Map Points table)

2. `v5/docs/WILDCARD_FILTERING.md`:
   - Created comprehensive documentation
   - Added examples for wildcards, OR, and AND operators
   - Documented all supported columns and use cases

---

## Technical Implementation Details

### matchWildcard() Function
```javascript
function matchWildcard(pattern, value)
```
- Supports wildcards: `*` matches any characters
- Supports OR: `|` or ` or ` separator
- Supports AND: ` and ` separator (requires all patterns to match)
- Handles array values (for multi-value fields like roles)
- Case-insensitive matching
- Falls back to substring matching without wildcards

### Filter Behavior
- **Single field (Username, Title, etc.)**: Tests pattern against single value
- **Multi-field (User compact view)**: Tests pattern against multiple fields with OR logic
- **Array field (Roles)**: Tests pattern against array of values, supports AND/OR logic

### Examples of Complex Queries
- `a* and s*` in Role column: Users with both admin and seeker roles
- `alice|bob` in Username: Users alice or bob
- `*park*|*beach*` in Title: Points containing park or beach
- `p*|h*|f*` in Status: Any status (pending, hidden, found)

---

## Key Improvements
1. ✅ Wildcard pattern matching (SQL LIKE-style)
2. ✅ OR operator support (`|` or `or`)
3. ✅ AND operator support (`and`)
4. ✅ Case-insensitive matching
5. ✅ Array value support for multi-value fields
6. ✅ Backward compatible (works without wildcards)
7. ✅ Comprehensive documentation

---

## Testing Recommendations
1. Test `A*` and `S*` individually in Role column
2. Test `A* or S*` for OR logic
3. Test `A* and S*` for AND logic
4. Test combinations in other columns
5. Verify case-insensitivity
6. Test without wildcards (substring matching)
