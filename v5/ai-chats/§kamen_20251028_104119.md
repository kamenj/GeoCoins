§kamen_20251028_104119

## Global Error Handler Implementation

### User Request
how to intercept js errors globally in the site ?

### Solution Overview
Implemented a comprehensive global error handler system that:
- Intercepts all JavaScript errors and unhandled promise rejections
- Logs errors with full details (timestamp, message, source, line, column, stack trace, userAgent, URL)
- Displays errors to all users via a red indicator button in the status bar
- Provides admin-only control to enable/disable the error handler
- Shows errors in a read-only JSON editor with copy/clear functionality

### Files Created
1. **errorHandler.js** - Standalone module for global error handling
   - `window.onerror` handler for synchronous errors
   - `unhandledrejection` event handler for async errors
   - Logs all errors to `State.Errors` array
   - Updates error indicator button automatically

### Files Modified

#### app.js
- Added `Errors_GlobalHandlerEnabled: true` to Config
- Added `Errors: []` and `errorsJsonEditor: null` to State
- Exposed `Config` and `State` to `window` for errorHandler.js access
- Added "Errors" to ContentSection constants
- Added `ErrorsHeader` to ElementId constants
- Created error handling functions:
  - `updateErrorIndicator()` - Shows/hides red error button (visible to all users)
  - `showErrorsInEditor()` - Displays errors in JSON editor (code mode, read-only)
  - `copyErrorsToClipboard()` - Copies error log to clipboard
  - `clearAllErrors()` - Clears all logged errors
- Added Errors commands to Config.Commands.LIST (copy, clear, refresh, close)
- Added "show.errors" menu item (visible to all users when errors exist)
- Updated Settings:
  - Added error handler checkbox (visible to admins only)
  - `openSettings()` - Shows/hides checkbox based on user role
  - `applySettings()` - Saves setting and reinitializes handlers (admin only)
- Initialized error handlers in `loadAll()`
- Added click event listener for Errors section header
- Added click event listener for status bar error button
- Added test error button in Developer Tools ("Test Error")
- Changed default user to "alice" (admin) for testing

#### index.html
- Added error indicator button to status bar: `<button id="statusBar-errors" class="error-indicator-btn">`
- Added error handler checkbox to Settings section (admin only)
- Added new Errors content section with JSON editor container

#### index.css
- Added styling for `.error-indicator-btn`:
  - Red background (#dc3545)
  - White text
  - Hover effect (#c82333)
  - Positioned in status bar

### Key Features

#### 1. Error Capture
- **Synchronous errors**: Caught by `window.onerror`
- **Unhandled promise rejections**: Caught by `unhandledrejection` event
- **Error details logged**: timestamp, type, message, source, line, column, stack, userAgent, URL

#### 2. User Interface
- **Red error button**: Appears in status bar when errors exist (shows error count)
- **Errors menu item**: Appears in top menu when errors exist
- **Errors view**: JSON editor in code mode (read-only) displaying all errors
- **Menu commands**: Copy to Clipboard, Clear All, Refresh, Close

#### 3. Access Control
- **All users**: Can see error button and view errors
- **Admins only**: Can enable/disable error handler in Settings

#### 4. Testing
- **Test Error button** in Developer Tools triggers realistic error:
  ```javascript
  var obj = null;
  var result = obj.someProperty.nestedProperty;
  ```
  This generates: `Cannot read properties of null (reading 'someProperty')`

### Configuration
- `Config.Errors_GlobalHandlerEnabled`: Controls whether error handler is active
- Error handler initializes automatically when page loads (if enabled)
- Setting can be toggled by admins in Settings view

### Error Log Format
Each error contains:
```json
{
  "timestamp": "2025-10-28T10:41:19.123Z",
  "type": "JavaScript Error",
  "message": "Cannot read properties of null (reading 'someProperty')",
  "source": "http://localhost/v5/app.js",
  "line": 787,
  "column": 28,
  "stack": "Error stack trace...",
  "userAgent": "Mozilla/5.0...",
  "url": "http://localhost/v5/index.html"
}
```

### Implementation Notes
- `Config` and `State` exposed to `window` for errorHandler.js to access them
- `updateErrorIndicator()` exposed to `window` for errorHandler.js to call it
- Error button uses event listener (not inline onclick) for proper module access
- JSON editor in code mode with ACE editor set to read-only
- Filter state preservation already implemented for Users table (not affected by error handler)

### User Workflow
1. Error occurs anywhere in the application
2. Error handler captures it and logs to `State.Errors`
3. Red "Errors (n)" button appears in status bar
4. User clicks button → Errors view opens
5. User sees all errors in JSON format (code view)
6. User can copy to clipboard or clear all errors
7. Admin can disable error handler in Settings if needed
